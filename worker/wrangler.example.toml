# CattoPic Worker Configuration Template
# Copy this file to wrangler.toml and fill in your values
# cp wrangler.example.toml wrangler.toml

name = 'cattopic-worker'
main = 'src/index.ts'
compatibility_date = '2025-12-10'
compatibility_flags = ['nodejs_compat']

[vars]
ENVIRONMENT = 'production'
# Your R2 bucket public URL (custom domain or workers.dev URL)
R2_PUBLIC_URL = 'pic.linyuan.cc'

# Images binding for image transformations (Cloudflare Images)
[images]
binding = "IMAGES"

# R2 Bucket binding
[[r2_buckets]]
binding = 'R2_BUCKET'
# Your R2 bucket name
bucket_name = 'cattopic-r2'

# D1 Database binding
[[d1_databases]]
binding = 'DB'
# Your D1 database name
database_name = 'CattoPic_D1'
# Your D1 database ID (get from: wrangler d1 list)
database_id = '1ae5bce6-6218-493d-ad4c-a21694e82152'

# KV Namespace for caching
[[kv_namespaces]]
binding = "CACHE_KV"
# Your KV namespace ID (get from: wrangler kv namespace list)
id = "fa8d93e30a594570933be552ff3dbed7"

# Queue for async R2 deletion
[[queues.producers]]
# Your queue name
queue = "cattopic-delete-queue-v2"
binding = "DELETE_QUEUE"

[[queues.consumers]]
# Same queue name as above
queue = "cattopic-delete-queue-v2"
max_batch_size = 10
max_batch_timeout = 5

# Cron Triggers - cleanup expired images every hour
[triggers]
crons = ['0 * * * *']

# Development settings
[dev]
port = 8787
local_protocol = 'http'

# Observability - logging configuration
[observability]
[observability.logs]
enabled = true
head_sampling_rate = 1
invocation_logs = true
persist = true
